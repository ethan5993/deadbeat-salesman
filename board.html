<!DOCTYPE html>
<html lang="en">
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
<meta http-equiv="Pragma" content="no-cache" />
<meta http-equiv="Expires" content="0" />
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Friends Board v2</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100 p-4">
  <h1 class="text-3xl font-bold mb-2">Friends Board</h1>
  <p id="greeting" class="mb-6 text-lg text-gray-700"></p>

  <div class="mb-6">
    <textarea id="newTopic" placeholder="Start a new topic..." class="w-full p-3 border rounded mb-2"></textarea>
    <button id="postTopicBtn" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded">Post Topic</button>
  </div>

  <div id="topics" class="space-y-4"></div>

 <script>
  const displayName = localStorage.getItem("displayName");
  if (!displayName) {
    window.location.href = "index.html";
  }

  const topics = [];

  document.addEventListener("DOMContentLoaded", () => {
    document.getElementById("greeting").textContent = `Hey, ${displayName}!`;

    const newTopicInput = document.getElementById("newTopic");
    const postTopicBtn = document.getElementById("postTopicBtn");
    const topicsContainer = document.getElementById("topics");

    function renderTopics() {
      topicsContainer.innerHTML = "";
      topics.forEach((topic, index) => {
        const topicDiv = document.createElement("div");
        topicDiv.className = "bg-white p-4 rounded shadow";

        topicDiv.innerHTML = `
          <div class="mb-2">
            <strong>${topic.author}:</strong> ${topic.content}
            ${topic.author === displayName ? `<button class="text-red-500 text-sm float-right" onclick="deleteTopic(${index})">Delete</button>` : ""}
          </div>
          <div class="ml-4">
            <div id="comments-${index}" class="space-y-1 mb-2">
              ${topic.comments.map((c, i) => `
                <div>
                  <em>${c.author}:</em> ${c.text}
                  ${c.author === displayName ? `<button class="text-red-400 text-xs ml-2" onclick="deleteComment(${index}, ${i})">x</button>` : ""}
                </div>`).join("")}
            </div>
            <input type="text" class="border p-1 text-sm w-full mb-1" placeholder="Add a comment..." onkeydown="handleComment(event, ${index})">
          </div>
        `;

        topicsContainer.appendChild(topicDiv);
      });
    }

    window.deleteTopic = function (index) {
      topics.splice(index, 1);
      renderTopics();
    };

    window.deleteComment = function (topicIndex, commentIndex) {
      topics[topicIndex].comments.splice(commentIndex, 1);
      renderTopics();
    };

    window.handleComment = function (e, topicIndex) {
      if (e.key === "Enter") {
        const text = e.target.value.trim();
        if (text) {
          topics[topicIndex].comments.push({ author: displayName, text });
          e.target.value = "";
          renderTopics();
        }
      }
    };

    postTopicBtn.addEventListener("click", () => {
      const content = newTopicInput.value.trim();
      if (content) {
        topics.unshift({ author: displayName, content, comments: [] });
        newTopicInput.value = "";
        renderTopics();
      }
    });
  });
</script>
</body>
</html>
